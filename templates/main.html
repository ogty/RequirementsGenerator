<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Requirements.txt Generator</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.2/themes/default/style.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.2/jstree.min.js"></script>
</head>
<body>
    <h1>Requirements.txt Generator</h1>
    <p>
        requirements.txtを生成します。<br>
        デフォルトではDesktop直下のフォルダを対象にしていますが、<br>
        settings.jsonの自分にあったOSのパスを変更することで、Desktop以外をカレントディレクトリに<br>
        設定することもできます。<br>
        現在の対応言語は、PythonとJuliaだけですが、自分で簡単に追加することもできます。<br>
        その場合はsettings.jsonとbase.pyを書き換える必要がありますが、詳しくはREADME.mdをご覧ください。
    </p>

    <form method="POST" onsubmit="return false;">
        <div class="select_language">
            <input type="radio" name="lang" value="python" checked>Python<br>
            <input type="radio" name="lang" value="julia">Julia
        </div>
        <div id="SimpleJSTree"></div>
        <button onclick="generate()">Generate</button>
    </form>
    <div id="result"></div>

    <script>
        let array = [];
        $.ajax({
            type: "GET",
            // url: "{{ url_for('static', filename='tree.json') }}",
            url: "../static/tree.json",
            dataType: "json"
        })
        .then(
            function(json) {
                console.log("Success");
                console.log(json)
                createJSTree(json)
            },
            function() {
                console.log("Failure");
            }
        );

        function createJSTree(jsondata) {
            $('#SimpleJSTree').jstree({
                'core': {
                    'data': jsondata["data"]
                },
            })
            .on('changed.jstree', function (e, data) {
                for(let i = 0; i < data.selected.length; i++) {
                    array.push(data.instance.get_node(data.selected[i]).text);
                }
                console.log(array.join(','));
            })
        }

        function generate() {
            $.ajax("/generate", {
                type: "POST",
                data: {
                    "language": $("input:radio[name='lang']:checked").val(),
                    "dir_list": array.join(',')
                },
                dataType: "json",
            }).done(function(data) {
                const message = JSON.parse(data.values).message
                $("#result").html(message);
                console.log("Communication successful.");
            }).fail(function(data) {
                console.log("Communication failed.");
            });
        }
    </script>
</body>
</html>